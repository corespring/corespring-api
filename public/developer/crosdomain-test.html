<!DOCTYPE html>
<html ng-app="corespring-dev">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="google-site-verification" content="-wfxFrZYKKRpF5_-V-G9g1wk5e8HrF2zKc-FKJ-NhNE" />
    <title>Index | CoreSpring</title>
    <link href='http://fonts.googleapis.com/css?family=Ubuntu:300,400,500,700' rel='stylesheet' type='text/css'>
    <link href="bootstrap/css/bootstrap.css" rel="stylesheet" type="text/css" media="all" />
    <link href="css/app.css" rel="stylesheet" type="text/css" media="all" />
    <link rel="shortcut icon" href="images/favicon.ico" type="image/x-icon" />
    <script type="text/javascript" src="js/vendor/less/1.3.0/less-1.3.0.min.js"></script>
    <script type="text/javascript" src="js/vendor/jquery/1.8.0/jquery-1.8.0.min.js"></script>
    <script type="text/javascript" src="js/vendor/ie.support/jQuery.XDomainRequest.js"></script>
    <script type="text/javascript" src="bootstrap/js/bootstrap.js"></script>
    <script type="text/javascript" src="js/vendor/underscore/1.3.3/underscore-min.js"></script>
    <script type="text/javascript" src="js/vendor/angular/1.0.1/angular-1.0.1.js"></script>
    <script type="text/javascript" src="js/vendor/waypoint/waypoints.js"></script>
    <script type="text/javascript" src="js/corespring/directives.js"></script>
    <script type="text/javascript" src="js/corespring/app.js"></script>

    <script type="text/javascript">

      //support ie cross domain calls
      $.support.cors = true;


      window.com = ( window.com || {} );
      window.com.linkDump = (com.linkDump || {} );

      function navigateToLink( hash ){

        var $target = $(hash);
        $target = $target.length && $target || $('[name=' + hash.slice(1) +']');
        if ($target.length) {
          var targetOffset = $target.offset().top - 70;
          $('html,body').animate({scrollTop: targetOffset}, 200);
          return false;
        }
      }





      $(document).ready(function(){


        $('a[href*=#]').click(function() {
          
          if( this.hash.indexOf("acc") == 1 ){
            return true;
          }

          if (location.pathname.replace(/^\//,'') == this.pathname.replace(/^\//,'') 
              && location.hostname == this.hostname) {
            navigateToLink(this.hash);
            window.location.hash = this.hash;
            return false;
          }
        });


          function setContentDivHeight(){
            //$(".main-content").height( $(window).height() - 70);
          }

          $(window).bind('resize', function(){
              setContentDivHeight();
          }); 

          setContentDivHeight();

          $(".accordion-body").on("shown", function() {
            com.linkDump.activeAccordion = this;
          });

          $(".api-well").find("a").click(function(){

            $(".api-well").find("a").parent().removeClass("active");
            $(this).parent().addClass("active");

            $(".waypoint").waypoint('destroy');
            setTimeout( initWaypoints, 200);
          });

          function initWaypoints(){
            /**
             * Disabling this for now as its a bit ropey.
             */
            //$(".waypoint").waypoint( waypointHandler, { context: $(".main-content"), onlyOnScroll: true });
          };
          

          function activateLinkAndOpenAccordian( $link ){

            $link.parent().addClass("active");
            var incomingAccordion = $link.closest(".accordion-body")[0];

           

            if( com.linkDump.activeAccordion == incomingAccordion ){
              return;
            }

            $(com.linkDump.activeAccordion).collapse("hide");

            setTimeout( function(){
              $(incomingAccordion).collapse("show");
              com.linkDump.activeAccordion = incomingAccordion;
              }, 200 );
          }



          function waypointHandler(event,direction){
            var name = $(event.currentTarget).attr('name');
            //window.location.hash = name;
            //console.log("name: " + name)
            $(".api-well").find("a").parent().removeClass("active");
            var $menuLink = $(".api-well").find( 'a[href$="'+name+'"]');
            activateLinkAndOpenAccordian($menuLink);
          }

          if( window.location.hash ){

            var activeLink = $(".api-well").find('a[href$="'+ window.location.hash+'"]');
            activateLinkAndOpenAccordian(activeLink);
          }

          setTimeout( initWaypoints, 200 );

          setTimeout( function() { navigateToLink( window.location.hash ) }, 200 );

      });
    </script>
  </head>

  <body ng-controller="MainController">

    <div class="navbar navbar-fixed-top">
      <div class="navbar-inner">
        <div class="container">
          <a class="brand" href="/"> 
            <img src="images/cs-white-logo-11px.png" alt="Corespring Content Tagger"/>
            <span class="developer">Developer</span>
          </a>
        </div>
      </div>
    </div>

    <div class="container main-container">

      <div class="well api-well" style="padding: 8px 0; width: 240px;">
        Liquid error: can't convert nil into String
      </div> 
      <!-- main content -->
      <div class="main-content">
          <h1>Ed testing cross-domain options</h1>

<script type="text/javascript">
  $(document).ready(function(){



    console.log(">>>>>>!!!!")
    $("#callApi").click( function(){

      $.support.cors = false;


      var request = {
            //url: "http://api-test.corespring.org/api/v1/items?access_token=34dj45a769j4e1c0h4wb",
            url: "http://therealurl.appspot.com/?format=json&amp;url=bit.ly/q&amp;callback=?",
            type: "GET",
            crossDomain: true,
            //cache:false,
            success: function( result ) { 
              console.log("success: " + result ) 
            },
            error: function(jqXHR, textStatus, errorThrown){ 
              console.log("Error")
            },
            dataType: "jsonp" 
          };



          $.ajax(request);


    });

    $("#callApiCors").click( function(){

      $.support.cors = true;


      var request = {
            url: "http://api-test.corespring.org/api/v1/items?access_token=34dj45a769j4e1c0h4wb",
            //url: "http://therealurl.appspot.com/?format=json&amp;url=bit.ly/q&amp;callback=?",
            type: "GET",
            crossDomain: true,
            //cache:false,
            success: function( result ) { 
              console.log("success: " + result ) 
            },
            error: function(jqXHR, textStatus, errorThrown){ 
              console.log("Error")
            },
            dataType: "json" 
          };

          $.ajax(request);

    });

    $("#callXDomainLink").click( function(){


      var url = $("#ieUrlInput").val();
      var xdr = new XDomainRequest();
      xdr.open("post", url);
      console.log( "url: " + url )
      xdr.onload = function () {
         console.log("Loading");
         console.log(xdr.responseText);
      };
      xdr.onsuccess = function() {
         console.log("Success!");
         console.log(xdr.responseText);
      };
      xdr.onerror = function() {
         console.log("Error!");
         console.log(xdr.responseText);
      };
      xdr.onprogress = function() {
         console.log("Progress");
         console.log(xdr.responseText);
      };
      xdr.timeout = 1000;

      var body = $("#ieDataInput").val();
      console.log( "body: " + body)

      xdr.send( body);
      var response = xdr.responseText;
      console.log(response );
    });

  });
</script>


<p><a id="callApi" href="#">Call the api using jsonp</a>
<a id="callApiCors" href="#">Call the api using cors</a></p>

<br/>


<p><input type="text" id="ieUrlInput" value="http://api-test.corespring.org/api/v1/collections?access_token=34dj45a769j4e1c0h4wb"></input></p>

<br/>


<p><textarea id="ieDataInput">{ "name" : "My Collection", "organizations": ["502404dd0364dc35bb39339a"] }</textarea></p>

<br/>


<p><a id="callXDomainLink">Call ie xdomain</a></p>
 
      </div>
    </body>
  </html>

